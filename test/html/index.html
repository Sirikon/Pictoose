<!DOCTYPE html>
<html>
<head>
	<title>Test Pictoose</title>
	<script type="text/javascript" src="jquery.js"></script>
</head>
<body>
	<form id="test">
		<label for="model">Modelo</label>
		<input type="text" name="model">
		<br>
		<label for="thumbnail">Thumbnail</label><br>
		<input type="file" for="thumbnail"><br>
		<textarea name="thumbnail" style="width:320px;height:120px;"></textarea><br>
		<img src="" im="thumbnail" style="width:200px;height:150px;" />
		<br><br>

		<label for="thumbnail">Brand</label><br>
		<input type="file" for="brand"><br>
		<textarea name="brand" style="width:320px;height:120px;"></textarea><br>
		<img src="" im="brand" style="width:200px;height:150px;" />
		<br><br>
		<input type="submit" value="Enviar">
	</form>
	<span id="theProgress">0%</span>
	<div style="width:600px;background-color:whitesmoke;height:50px;">
		<div id="theBar" style="width:0px;background-color:lightblue;height:50px;"></div>
	</div>
	<script>

		var data = {};

		$(document).on('change',"input[type='file']", function(e){
			var anchor = this;
			var reader = new FileReader();
		    reader.onload = function(event) {
		    	$("*[name='"+ $(anchor).attr('for') +"']").val(event.target.result);
		    	$("img[im='"+ $(anchor).attr('for') +"']").attr('src',event.target.result);
		    	data[$(anchor).attr('for')] = event.target.result;
		    };  
		    reader.readAsDataURL(e.target.files[0]);
		});

		$("form#test").on('submit', function(e){
			e.preventDefault();
			var el = $(this);
			data['model'] = $("input[name='model']").val();
			$.ajax({
				xhr: function(){
					var xhr = new window.XMLHttpRequest();
					xhr.upload.addEventListener('progress', function(evt){
						if(evt.lengthComputable){
							var percentComplete = (evt.loaded / evt.total)*100;
							$("#theBar").attr('style','width:'+(percentComplete*6)+'px;background-color:lightblue;height:50px;');
							$("#theProgress").html( (Math.round(percentComplete*100)/100).toString()+'%');
						}
					});
					return xhr
				},
				url: '/base64',
				data: data,
				method: 'POST',
				success: function(res){
					alert(res);
				}
			})
		});
	</script>
</body>
</html>